// Generated by CoffeeScript 1.6.3
(function() {
  (function($) {
    return $.fn.smartRecruiters = function(options) {
      var defaults,
        _this = this;
      defaults = {
        pageUrl: window.location.href,
        departmentHtmlElement: 'h4'
      };
      options = $.extend({}, defaults, options);
      return $.ajax({
        url: "http://www.smartrecruiters.com/cgi-bin/WebObjects/share.woa/wa/careersite",
        type: "GET",
        dataType: "xml",
        data: {
          wpp_company: options.companyName,
          installed_url: options.pageUrl
        },
        contentType: "application/jsonp; charset=utf-8"
      }).done(function(data) {
        var department, job, jobs, jobsByDepartment, ul, _i, _len, _name, _ref, _results;
        jobsByDepartment = {};
        _ref = $.xml2json(data).jobs.job;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          job = _ref[_i];
          if (job.department !== "") {
            (jobsByDepartment[_name = job.department] || (jobsByDepartment[_name] = [])).push(job);
          }
        }
        _results = [];
        for (department in jobsByDepartment) {
          jobs = jobsByDepartment[department];
          ul = $("<ul>").append((function() {
            var _j, _len1, _results1;
            _results1 = [];
            for (_j = 0, _len1 = jobs.length; _j < _len1; _j++) {
              job = jobs[_j];
              _results1.push($("<li>").append($("<a>").attr({
                href: job.detail_url,
                target: '_blank'
              }).text(job.title)));
            }
            return _results1;
          })());
          _results.push($("<" + options.departmentHtmlElement + ">").text(department).after(ul).appendTo(_this));
        }
        return _results;
      });
    };
  })(jQuery);

}).call(this);
